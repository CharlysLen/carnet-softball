<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel de administraci√≥n ‚Äî Liga de Softball Masters +40.">
    <title>Admin ‚Äî Softball Masters +40</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öôÔ∏è</text></svg>">
</head>

<body class="admin-body">

    <!-- Login Screen -->
    <div id="login-screen" class="login-overlay">
        <div class="login-card">
            <div style="font-size:3rem;margin-bottom:10px;">ü•é</div>
            <h1 class="login-title">PANEL DE ADMINISTRACI√ìN</h1>
            <p class="login-subtitle">Liga Softball Masters +40</p>
            <form id="login-form" autocomplete="off">
                <div class="form-group">
                    <label class="form-label" for="login-user">Usuario</label>
                    <input class="form-input" type="text" id="login-user" required placeholder="Usuario" autofocus>
                </div>
                <div class="form-group">
                    <label class="form-label" for="login-pass">Contrase√±a</label>
                    <input class="form-input" type="password" id="login-pass" required placeholder="Contrase√±a">
                </div>
                <div id="login-error" style="color:var(--red);font-size:0.8rem;margin-bottom:12px;display:none;">Usuario o contrase√±a incorrectos</div>
                <button type="submit" class="btn btn-primary" style="width:100%;padding:14px;font-size:1rem;">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel (hidden until login) -->
    <div id="admin-panel" style="display:none;">

    <header class="admin-header">

        <div class="admin-header-inner">
            <div style="flex:1">
                <h1 class="admin-title">ü•é PANEL DE ADMINISTRACI√ìN</h1>
                <div class="admin-subtitle">Liga Softball Masters +40 ‚Äî Gesti√≥n Oficial</div>
            </div>

            <nav style="display:flex;gap:20px;margin-right:auto;margin-left:40px;">
                <a href="#" class="nav-link active" onclick="Admin.switchTab('teams')"
                    style="color:var(--white);text-decoration:none;font-weight:600;font-size:0.9rem;">üõ° EQUIPOS</a>
                <a href="#" class="nav-link" onclick="Admin.switchTab('calendar')"
                    style="color:var(--white-muted);text-decoration:none;font-size:0.9rem;">üìÖ CALENDARIO</a>
                <a href="#" class="nav-link" onclick="Admin.switchTab('standings')"
                    style="color:var(--white-muted);text-decoration:none;font-size:0.9rem;">üèÜ CLASIFICACI√ìN</a>
                <a href="#" class="nav-link" id="nav-lineup" onclick="Admin.switchTab('lineup')"
                    style="color:var(--white-muted);text-decoration:none;font-size:0.9rem;">üìã ALINEACIONES</a>
                <a href="#" class="nav-link admin-only" id="nav-users" onclick="Admin.switchTab('users')"
                    style="color:var(--white-muted);text-decoration:none;font-size:0.9rem;display:none;">üë• USUARIOS</a>
            </nav>

            <div style="display:flex;align-items:center;gap:10px;margin-left:auto;">
                <span id="current-user-badge" style="font-size:0.75rem;color:var(--white-muted);"></span>
                <button class="btn btn-secondary" id="btn-logout" style="font-size:0.75rem;padding:6px 12px;" onclick="Admin.logout()">Salir</button>
            </div>

            <div class="admin-actions">
                <button class="btn btn-secondary" id="btn-add-team" style="display:none;">üõ° Nuevo Equipo</button>
                <button class="btn btn-secondary" id="btn-add-player" style="display:none;">+ Nuevo Jugador</button>
                <button class="btn btn-secondary" id="btn-import-csv" style="display:none;">üìÑ Importar CSV</button>
                <button class="btn btn-secondary" id="btn-export" style="display:none;">‚¨á Exportar JSON</button>
                <a href="qr-generator.html" class="btn btn-secondary" id="btn-qr" style="text-decoration:none;display:none;">üì± C√≥digos QR</a>
                <button class="btn btn-secondary" id="btn-demo" style="display:none;background:var(--bg-card);border:1px solid var(--gold);color:var(--gold);">üé≤ Datos Demo</button>
                <button class="btn btn-secondary" id="btn-reset" title="Borrar todo" style="display:none;color:var(--red);border-color:var(--red);">üóë</button>
            </div>
        </div>
    </header>

    <main class="admin-content">
        <div class="stats-row" id="stats-row"></div>
        <div id="main-content"></div>
    </main>

    <!-- Add Player Modal -->
    <div class="modal-overlay" id="modal-add-player">
        <div class="modal">
            <h2 class="modal-title">Nuevo Jugador</h2>
            <form id="add-player-form">
                <div class="form-group">
                    <label class="form-label" for="inp-nombre">Nombre Completo</label>
                    <input class="form-input" type="text" id="inp-nombre" required placeholder="Carlos Mendoza Garc√≠a">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="inp-dorsal">Dorsal</label>
                        <input class="form-input" type="number" id="inp-dorsal" required min="0" max="99"
                            placeholder="7">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="inp-posicion">Posici√≥n</label>
                        <select class="form-select" id="inp-posicion">
                            <option value="Pitcher">Pitcher</option>
                            <option value="Catcher">Catcher</option>
                            <option value="Primera Base">Primera Base</option>
                            <option value="Segunda Base">Segunda Base</option>
                            <option value="Tercera Base">Tercera Base</option>
                            <option value="Shortstop">Shortstop</option>
                            <option value="Left Field">Left Field</option>
                            <option value="Center Field">Center Field</option>
                            <option value="Right Field">Right Field</option>
                            <option value="Shortfield">Shortfield</option>
                            <option value="Utility">Utility</option>
                        </select>
                    </div>
                </div>
                <!-- Bio Section -->
                <div style="border-top:1px solid rgba(255,255,255,0.1);margin:16px 0;padding-top:16px;">
                    <label class="form-label" style="margin-bottom:8px;display:block;color:var(--gold);">Datos
                        F√≠sicos
                        (Opcional)</label>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">Altura (m)</label><input class="form-input"
                                type="text" id="inp-altura" placeholder="1.80"></div>
                        <div class="form-group"><label class="form-label">Peso (kg)</label><input class="form-input"
                                type="text" id="inp-peso" placeholder="85"></div>
                        <div class="form-group"><label class="form-label">Edad</label><input class="form-input"
                                type="number" id="inp-edad" placeholder="45"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="inp-email">Email <span style="color:var(--white-muted);font-weight:400">(opcional)</span></label>
                        <input class="form-input" type="email" id="inp-email" placeholder="jugador@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="inp-telefono">Tel√©fono <span style="color:var(--white-muted);font-weight:400">(opcional)</span></label>
                        <input class="form-input" type="tel" id="inp-telefono" placeholder="+34 600 000 000">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="inp-equipo">Equipo</label>
                    <select class="form-select" id="inp-equipo"></select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="inp-foto">Foto del Jugador <span
                            style="color:var(--white-muted);font-weight:400">(opcional)</span></label>
                    <input class="form-input" type="file" id="inp-foto" accept="image/*" style="padding:8px;">
                    <div id="foto-preview" style="margin-top:8px;display:none;">
                        <img id="foto-preview-img"
                            style="width:60px;height:60px;object-fit:cover;border-radius:10px;border:2px solid var(--gold);">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="inp-estado">Estado</label>
                        <select class="form-select" id="inp-estado">
                            <option value="habilitado">Habilitado</option>
                            <option value="suspendido">Suspendido</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="inp-verificado">Verificado</label>
                        <select class="form-select" id="inp-verificado">
                            <option value="true">S√≠</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                </div>
                <!-- Stats Section -->
                <div style="border-top:1px solid rgba(255,255,255,0.1);margin:16px 0;padding-top:16px;">
                    <label class="form-label" style="margin-bottom:8px;display:block;color:var(--gold);">Estad√≠sticas
                        (Opcional)</label>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">AVG</label><input class="form-input"
                                type="text" id="inp-avg" placeholder=".300"></div>
                        <div class="form-group"><label class="form-label">HR</label><input class="form-input"
                                type="number" id="inp-hr" placeholder="0"></div>
                        <div class="form-group"><label class="form-label">RBI</label><input class="form-input"
                                type="number" id="inp-rbi" placeholder="0"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">H</label><input class="form-input"
                                type="number" id="inp-h" placeholder="0"></div>
                        <div class="form-group"><label class="form-label">AB</label><input class="form-input"
                                type="number" id="inp-ab" placeholder="0"></div>
                        <div class="form-group"><label class="form-label">R</label><input class="form-input"
                                type="number" id="inp-r" placeholder="0"></div>
                    </div>
                </div>
                <input type="hidden" id="inp-id"> <!-- Hidden ID for editing -->
                <div id="fecha-alta-info" style="display:none;border-top:1px solid rgba(255,255,255,0.1);margin:16px 0;padding-top:12px;">
                    <label class="form-label" style="color:var(--gold);">Fecha de Alta</label>
                    <div id="fecha-alta-display" style="color:var(--white-soft);font-size:0.85rem;padding:6px 0;"></div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary"
                        onclick="Admin.closeModal('modal-add-player')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Jugador</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Team Modal -->
    <div class="modal-overlay" id="modal-add-team">
        <div class="modal">
            <h2 class="modal-title">üõ° Nuevo Equipo</h2>
            <form id="add-team-form">
                <div class="form-group">
                    <label class="form-label" for="team-nombre">Nombre del Equipo</label>
                    <input class="form-input" type="text" id="team-nombre" required placeholder="Leones de Alcorc√≥n">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="team-escudo">Escudo / Emoji</label>
                        <input class="form-input" type="text" id="team-escudo" value="ü•é" maxlength="4"
                            style="font-size:1.5rem;text-align:center;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="team-color">Color Principal</label>
                        <input class="form-input" type="color" id="team-color" value="#f5a623"
                            style="height:44px;padding:4px;">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="team-imagen">Imagen de Escudo <span
                            style="color:var(--white-muted);font-weight:400">(reemplaza el emoji)</span></label>
                    <input class="form-input" type="file" id="team-imagen" accept="image/*" style="padding:8px;">
                    <div id="team-imagen-preview" style="margin-top:8px;display:none;">
                        <img id="team-imagen-preview-img"
                            style="width:64px;height:64px;object-fit:contain;border-radius:10px;border:2px solid var(--gold);background:var(--bg-card-inner);padding:4px;">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="team-entrenador">Entrenador <span
                            style="color:var(--white-muted);font-weight:400">(opcional)</span></label>
                    <input class="form-input" type="text" id="team-entrenador" placeholder="Nombre del entrenador">
                </div>
                <div class="form-group">
                    <label class="form-label" for="team-email">Email de Contacto <span
                            style="color:var(--white-muted);font-weight:400">(opcional)</span></label>
                    <input class="form-input" type="email" id="team-email" placeholder="equipo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label class="form-label" for="team-telefono">Tel√©fono de Contacto <span
                            style="color:var(--white-muted);font-weight:400">(opcional)</span></label>
                    <input class="form-input" type="tel" id="team-telefono" placeholder="+34 600 123 456">
                </div>
                <div class="modal-actions">
                    <input type="hidden" id="team-original-name">
                    <button type="button" class="btn btn-secondary"
                        onclick="Admin.closeModal('modal-add-team')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Equipo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- CSV Import Modal -->
    <div class="modal-overlay" id="modal-import-csv">
        <div class="modal">
            <h2 class="modal-title">üìÑ Importar Jugadores (CSV)</h2>
            <p style="font-size:0.8rem;color:rgba(255,255,255,0.5);margin-bottom:16px;line-height:1.6;">
                Archivo <strong>.csv</strong> separado por <strong>;</strong>
            </p>
            <div
                style="background:var(--bg-card-inner);border-radius:8px;padding:12px 16px;margin-bottom:16px;font-family:monospace;font-size:0.75rem;color:var(--gold);overflow-x:auto;white-space:nowrap;">
                Nombre;Dorsal;Equipo;Posicion;Estado
            </div>
            <div class="form-group">
                <label class="form-label" for="csv-file">Archivo CSV</label>
                <input class="form-input" type="file" id="csv-file" accept=".csv,.txt" style="padding:8px;">
            </div>
            <div id="csv-preview" style="display:none;margin-bottom:16px;"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary"
                    onclick="Admin.closeModal('modal-import-csv')">Cancelar</button>
                <button type="button" class="btn btn-secondary" id="btn-download-template">‚Üì Plantilla</button>
                <button type="button" class="btn btn-primary" id="btn-confirm-import">Importar</button>
            </div>
        </div>
    </div>

    <!-- Match Stats CSV Modal -->
    <div class="modal-overlay" id="modal-match-csv">
        <div class="modal">
            <h2 class="modal-title">üì§ Subir Estad√≠sticas del Partido</h2>
            <p style="font-size:0.8rem;color:rgba(255,255,255,0.5);margin-bottom:12px;line-height:1.6;">
                Sube el CSV con las estad√≠sticas individuales. Formato: <strong>JugadorID;Nombre;Equipo;AB;H;HR;RBI;R</strong>
            </p>
            <div class="form-group">
                <label class="form-label" for="match-csv-file">Archivo CSV</label>
                <input class="form-input" type="file" id="match-csv-file" accept=".csv,.txt" style="padding:8px;">
            </div>
            <div id="match-csv-preview" style="display:none;margin-bottom:16px;"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="Admin.closeModal('modal-match-csv')">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btn-confirm-match-csv">Importar Stats</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div class="modal-overlay" id="modal-add-user">
        <div class="modal">
            <h2 class="modal-title">üë• Nuevo Usuario</h2>
            <form id="add-user-form">
                <div class="form-group">
                    <label class="form-label" for="usr-nombre">Nombre Completo</label>
                    <input class="form-input" type="text" id="usr-nombre" required placeholder="Carlos L√≥pez">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="usr-user">Usuario</label>
                        <input class="form-input" type="text" id="usr-user" required placeholder="carlos">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="usr-pass">Contrase√±a</label>
                        <input class="form-input" type="text" id="usr-pass" required placeholder="1234">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="usr-rol">Rol</label>
                        <select class="form-select" id="usr-rol">
                            <option value="delegado">Delegado (Entrenador)</option>
                            <option value="superusuario">Superusuario (Gesti√≥n)</option>
                            <option value="usuario">Usuario (Jugador)</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="usr-equipo">Equipo Asignado</label>
                        <select class="form-select" id="usr-equipo"></select>
                    </div>
                </div>
                <input type="hidden" id="usr-id">
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="Admin.closeModal('modal-add-user')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Usuario</button>
                </div>
            </form>
        </div>
    </div>

    </div><!-- /admin-panel -->

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/admin.js"></script>
    <script>
    (function() {
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');

        function showAdmin() {
            loginScreen.style.display = 'none';
            adminPanel.style.display = 'block';
        }

        // Check if already logged in this session
        if (sessionStorage.getItem('admin_auth_id')) {
            showAdmin();
        }

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const user = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value;
            const usuarios = AppStore.getUsers();
            const found = usuarios.find(u => u.user === user && u.pass === pass);
            if (found) {
                sessionStorage.setItem('admin_auth_id', found.id);
                sessionStorage.setItem('admin_auth_rol', found.rol);
                sessionStorage.setItem('admin_auth_equipo', found.equipo || '');
                sessionStorage.setItem('admin_auth_nombre', found.nombre);
                showAdmin();
                if (typeof Admin !== 'undefined') {
                    if (Admin.applyPermissions) Admin.applyPermissions();
                    if (Admin.renderView) Admin.renderView();
                }
            } else {
                loginError.style.display = 'block';
                document.getElementById('login-pass').value = '';
                document.getElementById('login-pass').focus();
            }
        });
    })();
    </script>
</body>

</html>